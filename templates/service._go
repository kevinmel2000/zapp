package service

import (
	"{{PackageName}}/dao"
	"{{PackageName}}/model" 
	"{{PackageName}}/shared/transaction" {{if (eq DataTypeId "guid")}}
	"{{PackageName}}/utils" {{end}}
)

// I{{PascalCase .Name}}Service is
type I{{PascalCase .Name}}Service interface { {{if (eq DataTypeId "int")}}
	Create(obj model.Create{{PascalCase .Name}}Request) (uint64, error) 	
	GetOne(ID uint64) *model.{{PascalCase .Name}}
	GetAll(page, size int, sortBy, sortDir string, filter map[string]string) ([]model.{{PascalCase .Name}}, uint)
	Delete(ID uint64) error
	Update(ID uint64, obj model.Update{{PascalCase .Name}}Request) error {{else}}
	Create(obj model.Create{{PascalCase .Name}}Request) (string, error) 
	GetOne(ID string) *model.{{PascalCase .Name}}
	GetAll(page, size int, sortBy, sortDir string, filter map[string]string) ([]model.{{PascalCase .Name}}, uint)
	Delete(ID string) error
	Update(ID string, obj model.Update{{PascalCase .Name}}Request) error {{end}}
}

// {{PascalCase .Name}}Service is
type {{PascalCase .Name}}Service struct {
	{{CamelCase .Name}}Dao dao.I{{PascalCase .Name}}Dao
	trx transaction.ITransaction
}

// New{{PascalCase .Name}}Service is
func New{{PascalCase .Name}}Service(trx transaction.ITransaction, {{CamelCase .Name}}Dao dao.I{{PascalCase .Name}}Dao) *{{PascalCase .Name}}Service {
	return &{{PascalCase .Name}}Service{ 
		{{CamelCase .Name}}Dao: {{CamelCase .Name}}Dao,
		trx: trx,
	}
}

// Create is {{if (eq DataTypeId "int")}}
func (g *{{PascalCase .Name}}Service) Create(dto model.Create{{PascalCase .Name}}Request) (uint64, error) { {{else}}
func (g *{{PascalCase .Name}}Service) Create(dto model.Create{{PascalCase .Name}}Request) (uint64, error) {	{{end}}

	var obj model.{{PascalCase .Name}}
	{{if (eq DataTypeId "guid")}}
	obj.ID = utils.GenID() {{end}} {{range .Fields}}
	obj.{{.Name}} = dto.{{.Name}} {{end}}

	tx := g.trx.GetDB(true)
	g.{{CamelCase .Name}}Dao.Create(tx, &obj)
	g.trx.CommitTransaction(tx)
	return obj.ID, nil
}

// GetOne is {{if (eq DataTypeId "int")}}
func (g *{{PascalCase .Name}}Service) GetOne(ID uint64) *model.{{PascalCase .Name}} { {{else}}
func (g *{{PascalCase .Name}}Service) GetOne(ID string) *model.{{PascalCase .Name}} { {{end}}
	return g.{{CamelCase .Name}}Dao.GetOne(g.trx.GetDB(false), ID)
}

// GetAll is
func (g *{{PascalCase .Name}}Service) GetAll(page, size int, sortBy, sortDir string, filter map[string]string) ([]model.{{PascalCase .Name}}, uint) {
	return g.{{CamelCase .Name}}Dao.GetAll(g.trx.GetDB(false), page, size, sortBy, sortDir, filter)
}

// Delete is {{if (eq DataTypeId "int")}}
func (g *{{PascalCase .Name}}Service) Delete(ID uint64) error { {{else}}
func (g *{{PascalCase .Name}}Service) Delete(ID string) error {	{{end}}
	tx := g.trx.GetDB(true)
	a := g.{{CamelCase .Name}}Dao.Delete(tx, ID)
	g.trx.CommitTransaction(tx)
	return a
}

// Update is {{if (eq DataTypeId "int")}}
func (g *{{PascalCase .Name}}Service) Update(ID uint64, dto model.Update{{PascalCase .Name}}Request) error { {{else}}
func (g *{{PascalCase .Name}}Service) Update(ID string, dto model.Update{{PascalCase .Name}}Request) error { {{end}}

	var obj model.{{PascalCase .Name}} 
	{{range .Fields}}
	obj.{{.Name}} = dto.{{.Name}} {{end}}

	tx := g.trx.GetDB(true)
	a := g.{{CamelCase .Name}}Dao.Update(tx, ID, &obj)
	g.trx.CommitTransaction(tx)
	return a
}
