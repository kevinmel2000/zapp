package repository

import (
	"{{PackagePath}}/backend/model"
	"{{PackagePath}}/backend/shared/transaction"
	"github.com/jinzhu/gorm"
)

// SystemUserRepository is
type SystemUserRepository interface {
	Create(db interface{}, obj *model.SystemUser) error
	GetByEmail(db interface{}, email string) *model.SystemUser
	GetOne(db interface{}, ID string) *model.SystemUser
}

// systemUserRepository is
type systemUserRepository struct{}

// NewSystemUserRepository is
func NewSystemUserRepository(db *gorm.DB) SystemUserRepository {
	db.AutoMigrate(&model.SystemUser{})
	return &systemUserRepository{}
}

// Create is
func (u *systemUserRepository) Create(db interface{}, obj *model.SystemUser) error {
	return transaction.ExtractDB(db).Create(obj).Error
}

// GetByEmail is
func (u *systemUserRepository) GetByEmail(db interface{}, email string) *model.SystemUser {
	var obj model.SystemUser
	transaction.ExtractDB(db).First(&obj, "email = ?", email)
	if obj.ID == "" {
		return nil
	}
	return &obj

}

// GetOne is
func (u *systemUserRepository) GetOne(db interface{}, ID string) *model.SystemUser {
	var obj model.SystemUser

	query := transaction.ExtractDB(db)

	query.First(&obj, "id = ?", ID)

	if obj.ID == "" {
		return nil
	}
	return &obj
}