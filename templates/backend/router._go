package main

import (
	"net/http"
	"time"

	"{{PackagePath}}/controller"
	"github.com/gin-contrib/cors"
	"github.com/gin-gonic/gin"
)

// RouterConfig is
type RouterConfig struct {
	router                       *gin.Engine 	{{range .Entities}}
	{{CamelCase .Name}}Controller *controller.{{PascalCase .Name}}Controller {{end}}
}

// UseCors is
func (r *RouterConfig) UseCors() {
	r.router.Use(cors.New(cors.Config{
		ExposeHeaders:   []string{"Data-Length"},
		AllowMethods:    []string{"GET", "POST", "PUT", "DELETE", "PATCH", "HEAD", "OPTIONS"},
		AllowAllOrigins: true,
		AllowHeaders:    []string{"Content-Type", "Authorization"},
		MaxAge:          12 * time.Hour,
	}))
}

// Setup is
func (r *RouterConfig) Setup() {

	r.router.StaticFile("./favicon.ico", "../webcontent/favicon.ico")
	r.router.Static("/static", "../webcontent/static")
	r.router.LoadHTMLGlob("../webcontent/templates/*")
	r.router.GET("/", func(c *gin.Context) {
		c.HTML(http.StatusOK, "index.html", gin.H{"title": "MainMenu"})
	})
  {{range .Entities}}
  // {{PascalCase .Name}}
  {
    r.router.Handle("POST", "/{{CamelCase .Name}}", r.{{CamelCase .Name}}Controller.Create)
    r.router.Handle("GET", "/{{CamelCase .Name}}", r.{{CamelCase .Name}}Controller.GetAll)
    r.router.Handle("GET", "/{{CamelCase .Name}}/:{{CamelCase .Name}}ID", r.{{CamelCase .Name}}Controller.GetOne)
    r.router.Handle("DELETE", "/{{CamelCase .Name}}/:{{CamelCase .Name}}ID", r.{{CamelCase .Name}}Controller.Delete)
    r.router.Handle("PUT", "/{{CamelCase .Name}}/:{{CamelCase .Name}}ID", r.{{CamelCase .Name}}Controller.Update)
  } {{end}}
}
